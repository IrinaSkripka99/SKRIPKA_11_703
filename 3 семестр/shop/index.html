<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Корзина</title>
    <script type="text/javascript" src="jquery-1.5.min.js"></script>
    <script type="text/javascript" src="jquery-ui-1.8.9.custom.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <script type="text/javascript">
   var total_items = 0;
   var total_price = 0;
   $(document).ready(function() {

       $(".item").draggable({
           revert: true
       });
       $("#cart_items").draggable({
           axis: "x"
       });

       $("#cart_items").droppable({
           accept: ".item",
           activeClass: "drop-active",
           hoverClass: "drop-hover",
           drop: function(event, ui) {
               var item = ui.draggable.html();
               var itemid = ui.draggable.attr("id");
               var html = '<div class="item icart">';
               html = html + '<div class="divrm">';
               html = html + '<a onclick="remove(this)" class="remove '+itemid+'">&times;</a>';
               html = html + '<div/>'+item+'</div>';
               $("#cart_items").append(html);

               // Обновление общего количества
               total_items++;
               $("#citem").html(total_items);

               // Обновление общей цены
               var price = parseInt(ui.draggable.find(".price").html().replace(" р.", ""));
               total_price = total_price + price;
               $("#cprice").html(total_price + " р.");

               // Расширяем корзину
               if (total_items > 4) {
                   $("#cart_items").animate({width: "+=120"}, 'slow');
               }
           }
       });


       $("#btn_next").click(function() {
           $("#cart_items").animate({left: "-=100"}, 100);
           return false;
       });
       $("#btn_prev").click(function() {
           $("#cart_items").animate({left: "+=100"}, 100);
           return false;
       });
       $("#btn_clear").click(function() {
           $("#cart_items").fadeOut("2000", function() {
              $(this).html("").fadeIn("fast").css({left: 0});
           });
           $("#citem").html("0");
           $("#cprice").html("0 р.");
           total_items = 0;
           total_price = 0;
           return false;
       });
   });
   function remove(el) {
       $(el).hide();
       $(el).parent().parent().effect("highlight", {color: "#ff0000"}, 1000);
       $(el).parent().parent().fadeOut('1000');
       setTimeout(function() {
           $(el).parent().parent().remove();
           // Сворачиваем позицию в корзине
           if (total_items > 3) {
               $("#cart_items").animate({width: "-=120"}, 'slow');
           }
       }, 1100);

       // Обновляем общее количество
       total_items--;
       $("#citem").html(total_items);

       // Обновляем общую цену
       var price = parseInt($(el).parent().parent().find(".price").html().replace(" р.", ""));
       total_price = total_price - price;
       $("#cprice").html(total_price + " р.");
   }
   </script>
  </head>
  <body>
      <div id="item_container">
          <div class="item" id="i1">
              <img src="img/table1.jpg"/>
              <label class="title">Стол на две персоны</label>
              <label class="price">12$</label>
          </div>
          <div class="item" id="i2">
              <img src="img/table2.jpg"/>
              <label class="title">Стол на три персоны</label>
              <label class="price">20$</label>
          </div>
          <div class="item" id="i3">
              <img src="img/table3.jpg"/>
              <label class="title">Стол на четыре персоны</label>
              <label class="price">27$</label>
          </div>
          <div class="item" id="i4">
              <img src="img/table4.jpg"/>
              <label class="title">Стол на пять персон</label>
              <label class="price">25$</label>
          </div>
          <div class="item" id="i5">
              <img src="img/table5.jpg"/>
              <label class="title">Стол на 6 персон</label>
              <label class="price">40$</label>
          </div>
          <div class="clear"></div>
      </div>
      <div id="cart_container">
          <div id="cart_title">
              <span>Корзина покупок</span>
              <div class="clear"></div>
          </div>
          <div id="cart_toolbar">
              <div id="cart_items" class="back"></div>
          </div>
          <div id="navigate">
              <div id="nav_left">
                  <a href="" id="btn_prev"><</a>
                  <a href="" id="btn_next">></a>
                  <a href="" id="btn_clear">Очистить корзину</a>
              </div>
              <div id="nav_right">
                  <span class="sptext">
                      <label>Покупок </label><label class="count" id="citem">0</label>
                  </span>
                  <span class="sptext">
                      <label>Цена </label><label class="count" id="cprice">0 $</label>
                  </span>
              </div>
              <div class="clear"></div>
          </div>
      </div>
  </body>
</html>
